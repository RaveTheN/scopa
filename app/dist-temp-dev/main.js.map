{"version":3,"file":"main.js","mappings":"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","sources":["./src/app/app.component.ts","./src/app/app.component.html","./src/app/app.config.ts","./src/app/app.routes.ts","./src/app/components/ai-suggestion-panel/ai-suggestion-panel.component.ts","./src/app/components/ai-suggestion-panel/ai-suggestion-panel.component.html","./src/app/components/card-cell/card-cell.component.ts","./src/app/components/card-cell/card-cell.component.html","./src/app/components/card-grid/card-grid.component.ts","./src/app/components/card-grid/card-grid.component.html","./src/app/components/hand-selector/hand-selector.component.ts","./src/app/components/hand-selector/hand-selector.component.html","./src/app/components/log-bar/log-bar.component.ts","./src/app/components/log-bar/log-bar.component.html","./src/app/components/stats-panel/stats-panel.component.ts","./src/app/components/stats-panel/stats-panel.component.html","./src/app/components/toolbar/toolbar.component.ts","./src/app/components/toolbar/toolbar.component.html","./src/app/models/card.model.ts","./src/app/services/ai-suggestion.service.ts","./src/app/services/card-tracker.service.ts","./src/app/services/game-state.service.ts","./src/app/services/local-storage.service.ts","./src/app/services/openai.service.ts","./src/app/services/probability.service.ts","./src/app/utils/combinations.util.ts","./src/environments/environment.ts","./src/main.ts"],"sourcesContent":["import { CommonModule } from '@angular/common';\r\nimport { Component } from '@angular/core';\r\nimport { combineLatest, map } from 'rxjs';\r\nimport { AISuggestionService } from './services/ai-suggestion.service';\r\nimport { GameStateService } from './services/game-state.service';\r\nimport { ProbabilityService } from './services/probability.service';\r\nimport { CardGridComponent } from './components/card-grid/card-grid.component';\r\nimport { ToolbarComponent } from './components/toolbar/toolbar.component';\r\nimport { StatsPanelComponent } from './components/stats-panel/stats-panel.component';\r\nimport { HandSelectorComponent } from './components/hand-selector/hand-selector.component';\r\nimport { AISuggestionPanelComponent } from './components/ai-suggestion-panel/ai-suggestion-panel.component';\r\nimport { LogBarComponent } from './components/log-bar/log-bar.component';\r\nimport { CardState, GamePhase, GameState } from './models/card.model';\r\n\r\ninterface TableViewModel {\r\n  cardStates: Record<string, CardState>;\r\n  probabilities: Record<number, number>;\r\n  selectableCardIds: Set<string>;\r\n  phase: GamePhase;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ToolbarComponent,\r\n    StatsPanelComponent,\r\n    CardGridComponent,\r\n    HandSelectorComponent,\r\n    AISuggestionPanelComponent,\r\n    LogBarComponent\r\n  ],\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss']\r\n})\r\nexport class AppComponent {\r\n  readonly gamePhase = GamePhase;\r\n  readonly phase$ = this.gameStateService.phase;\r\n\r\n  readonly tableVm$ = combineLatest([\r\n    this.gameStateService.state,\r\n    this.probabilityService.probabilities$\r\n  ]).pipe(\r\n    map(([state, probabilities]): TableViewModel => {\r\n      const probabilityRecord: Record<number, number> = {};\r\n      for (let rank = 1; rank <= 10; rank += 1) {\r\n        probabilityRecord[rank] = probabilities.get(rank) ?? 0;\r\n      }\r\n\r\n      return {\r\n        cardStates: state.cardStates,\r\n        probabilities: probabilityRecord,\r\n        selectableCardIds: this.buildSelectableSet(state),\r\n        phase: state.phase\r\n      };\r\n    })\r\n  );\r\n\r\n  constructor(\r\n    private readonly gameStateService: GameStateService,\r\n    private readonly probabilityService: ProbabilityService,\r\n    private readonly aiSuggestionService: AISuggestionService\r\n  ) {\r\n    void this.aiSuggestionService;\r\n  }\r\n\r\n  onTableCardClicked(cardId: string, phase: GamePhase): void {\r\n    if (phase === GamePhase.CHOOSE_COMBINATION) {\r\n      this.gameStateService.selectCombinationCard(cardId);\r\n      return;\r\n    }\r\n\r\n    this.gameStateService.clickTableCard(cardId);\r\n  }\r\n\r\n  private buildSelectableSet(state: GameState): Set<string> {\r\n    const selectable = new Set<string>();\r\n\r\n    if (state.phase === GamePhase.INITIAL_FOUR) {\r\n      for (const [cardId, cardState] of Object.entries(state.cardStates)) {\r\n        if (cardState === CardState.UNKNOWN || cardState === CardState.ON_TABLE) {\r\n          selectable.add(cardId);\r\n        }\r\n      }\r\n      return selectable;\r\n    }\r\n\r\n    if (state.phase === GamePhase.PLAYING) {\r\n      for (const [cardId, cardState] of Object.entries(state.cardStates)) {\r\n        if (state.turn === 'ME' && cardState === CardState.IN_MY_HAND) {\r\n          selectable.add(cardId);\r\n        }\r\n\r\n        if (state.turn === 'OPPONENT' && cardState === CardState.UNKNOWN) {\r\n          selectable.add(cardId);\r\n        }\r\n      }\r\n      return selectable;\r\n    }\r\n\r\n    for (const [cardId, cardState] of Object.entries(state.cardStates)) {\r\n      if (cardState === CardState.ON_TABLE || cardState === CardState.COMBINATION_CANDIDATE) {\r\n        selectable.add(cardId);\r\n      }\r\n    }\r\n\r\n    return selectable;\r\n  }\r\n}\r\n","<div class=\"app-container\">\r\n  <h1>Scopa</h1>\r\n\r\n  <app-toolbar />\r\n\r\n  <app-stats-panel />\r\n\r\n  <div class=\"banner-warning\" *ngIf=\"(phase$ | async) === gamePhase.CHOOSE_COMBINATION\">\r\n    Selezionare combinazione\r\n  </div>\r\n\r\n  <div class=\"main-content\" *ngIf=\"tableVm$ | async as tableVm\">\r\n    <div>\r\n      <h2>Tavolo</h2>\r\n      <app-card-grid\r\n        mode=\"table\"\r\n        [cardStates]=\"tableVm.cardStates\"\r\n        [probabilities]=\"tableVm.probabilities\"\r\n        [selectableCardIds]=\"tableVm.selectableCardIds\"\r\n        [phase]=\"tableVm.phase\"\r\n        (cardClicked)=\"onTableCardClicked($event, tableVm.phase)\"\r\n      />\r\n    </div>\r\n\r\n    <app-hand-selector />\r\n\r\n    <app-ai-suggestion-panel />\r\n  </div>\r\n\r\n  <app-log-bar />\r\n</div>\r\n","import { ApplicationConfig } from '@angular/core';\r\nimport { provideHttpClient } from '@angular/common/http';\r\nimport { provideRouter } from '@angular/router';\r\nimport { routes } from './app.routes';\r\n\r\nexport const appConfig: ApplicationConfig = {\r\n  providers: [\r\n    provideRouter(routes),\r\n    provideHttpClient()\r\n  ]\r\n};\r\n","import { Routes } from '@angular/router';\r\n\r\nexport const routes: Routes = [];\r\n","import { CommonModule } from '@angular/common';\r\nimport { Component } from '@angular/core';\r\nimport { AISuggestionService } from '../../services/ai-suggestion.service';\r\nimport { GameStateService } from '../../services/game-state.service';\r\n\r\n@Component({\r\n  selector: 'app-ai-suggestion-panel',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './ai-suggestion-panel.component.html',\r\n  styleUrls: ['./ai-suggestion-panel.component.scss']\r\n})\r\nexport class AISuggestionPanelComponent {\r\n  readonly aiSuggestion$ = this.gameStateService.aiSuggestion;\r\n  readonly aiLoading$ = this.gameStateService.aiLoading;\r\n\r\n  constructor(\r\n    private readonly gameStateService: GameStateService,\r\n    private readonly aiSuggestionService: AISuggestionService\r\n  ) {}\r\n\r\n  get apiConfigured(): boolean {\r\n    return this.aiSuggestionService.isApiConfigured();\r\n  }\r\n\r\n  manualQuery(): void {\r\n    this.aiSuggestionService.manualQuery();\r\n  }\r\n}\r\n","<div class=\"ai-panel\">\n  <div class=\"ai-header\">&#129302; Suggerimento AI</div>\n\n  <div class=\"spinner\" *ngIf=\"aiLoading$ | async\"></div>\n\n  <p class=\"api-note\" *ngIf=\"!apiConfigured\">\n    Configura endpoint backend OpenAI in environment.ts\n  </p>\n\n  <div class=\"ai-text\">{{ (aiSuggestion$ | async) || 'Nessun suggerimento disponibile' }}</div>\n\n  <button type=\"button\" class=\"ai-btn\" (click)=\"manualQuery()\">Chiedi suggerimento</button>\n</div>\n","import { CommonModule } from '@angular/common';\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Card, CardState } from '../../models/card.model';\n\n@Component({\n  selector: 'app-card-cell',\n  standalone: true,\n  imports: [CommonModule],\n  templateUrl: './card-cell.component.html',\n  styleUrls: ['./card-cell.component.scss']\n})\nexport class CardCellComponent {\n  @Input({ required: true }) card!: Card;\n  @Input({ required: true }) state!: CardState;\n  @Input() probability: number | null = null;\n  @Input() mode: 'table' | 'hand' = 'table';\n  @Input() selectable = true;\n\n  @Output() clicked = new EventEmitter<void>();\n\n  protected readonly cardState = CardState;\n\n  onClick(): void {\n    if (this.state === CardState.PLAYED) {\n      return;\n    }\n\n    if (!this.selectable) {\n      return;\n    }\n\n    this.clicked.emit();\n  }\n\n  get mainText(): string {\n    if (this.state === CardState.PLAYED) {\n      return '\\u2713';\n    }\n\n    return `${this.card.rank}`;\n  }\n\n  get subText(): string {\n    if (this.state === CardState.IN_MY_HAND) {\n      return 'mia';\n    }\n\n    if (this.state === CardState.UNKNOWN && this.mode === 'table' && this.probability !== null) {\n      return `${Math.round(this.probability * 100)}%`;\n    }\n\n    return '';\n  }\n\n  get showSubText(): boolean {\n    if (this.state === CardState.IN_MY_HAND) {\n      return true;\n    }\n\n    return this.state === CardState.UNKNOWN && this.mode === 'table' && this.probability !== null;\n  }\n}","<button\r\n  type=\"button\"\r\n  class=\"cell-button\"\r\n  [class.table-mode]=\"mode === 'table'\"\r\n  [class.hand-mode]=\"mode === 'hand'\"\r\n  [class.state-unknown]=\"state === cardState.UNKNOWN\"\r\n  [class.state-in-my-hand]=\"state === cardState.IN_MY_HAND\"\r\n  [class.state-on-table]=\"state === cardState.ON_TABLE\"\r\n  [class.state-on-table-blinking]=\"state === cardState.ON_TABLE_BLINKING\"\r\n  [class.state-played]=\"state === cardState.PLAYED\"\r\n  [class.state-combination-candidate]=\"state === cardState.COMBINATION_CANDIDATE\"\r\n  [class.not-selectable]=\"!selectable && state !== cardState.PLAYED && state !== cardState.ON_TABLE_BLINKING\"\r\n  (click)=\"onClick()\"\r\n>\r\n  <span class=\"cell-main\">{{ mainText }}</span>\r\n  <span\r\n    class=\"cell-sub\"\r\n    [class.sub-mine]=\"state === cardState.IN_MY_HAND\"\r\n    *ngIf=\"showSubText\"\r\n  >\r\n    {{ subText }}\r\n  </span>\r\n</button>\r\n\r\n","import { CommonModule } from '@angular/common';\r\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\r\nimport {\r\n  Card,\r\n  CardState,\r\n  GamePhase,\r\n  RANKS,\r\n  SUITS,\r\n  Suit,\r\n  createCardId\r\n} from '../../models/card.model';\r\nimport { CardCellComponent } from '../card-cell/card-cell.component';\r\n\r\n@Component({\r\n  selector: 'app-card-grid',\r\n  standalone: true,\r\n  imports: [CommonModule, CardCellComponent],\r\n  templateUrl: './card-grid.component.html',\r\n  styleUrls: ['./card-grid.component.scss']\r\n})\r\nexport class CardGridComponent {\r\n  @Input() mode: 'table' | 'hand' = 'table';\r\n  @Input() cardStates: Record<string, CardState> = {};\r\n  @Input() probabilities: Record<number, number> = {};\r\n  @Input() selectableCardIds: Set<string> = new Set<string>();\r\n  @Input() phase: GamePhase = GamePhase.INITIAL_FOUR;\r\n\r\n  @Output() cardClicked = new EventEmitter<string>();\r\n\r\n  readonly suits: Suit[] = SUITS;\r\n  readonly ranks: number[] = RANKS;\r\n\r\n  protected readonly cardState = CardState;\r\n\r\n  trackByRank(_: number, rank: number): number {\r\n    return rank;\r\n  }\r\n\r\n  trackBySuit(_: number, suit: Suit): Suit {\r\n    return suit;\r\n  }\r\n\r\n  getCard(suit: Suit, rank: number): Card {\r\n    return {\r\n      id: createCardId(suit, rank),\r\n      suit,\r\n      rank\r\n    };\r\n  }\r\n\r\n  getState(cardId: string): CardState {\r\n    return this.cardStates[cardId] ?? CardState.UNKNOWN;\r\n  }\r\n\r\n  getProbability(rank: number): number | null {\r\n    if (this.mode !== 'table') {\r\n      return null;\r\n    }\r\n\r\n    return this.probabilities[rank] ?? 0;\r\n  }\r\n\r\n  isSelectable(cardId: string): boolean {\r\n    return this.selectableCardIds.has(cardId);\r\n  }\r\n\r\n  onCardClick(cardId: string): void {\r\n    this.cardClicked.emit(cardId);\r\n  }\r\n}\r\n","<table class=\"card-grid\">\r\n  <thead>\r\n    <tr>\r\n      <th *ngFor=\"let suit of suits; trackBy: trackBySuit\">{{ suit }}</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr *ngFor=\"let rank of ranks; trackBy: trackByRank\">\r\n      <td *ngFor=\"let suit of suits; trackBy: trackBySuit\">\r\n        <ng-container *ngIf=\"getCard(suit, rank) as card\">\r\n          <app-card-cell\r\n            [card]=\"card\"\r\n            [state]=\"getState(card.id)\"\r\n            [probability]=\"getProbability(rank)\"\r\n            [mode]=\"mode\"\r\n            [selectable]=\"isSelectable(card.id)\"\r\n            (clicked)=\"onCardClick(card.id)\"\r\n          />\r\n        </ng-container>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n","import { CommonModule } from '@angular/common';\r\nimport { Component } from '@angular/core';\r\nimport { map } from 'rxjs';\r\nimport { CardState, GamePhase } from '../../models/card.model';\r\nimport { GameStateService } from '../../services/game-state.service';\r\nimport { CardGridComponent } from '../card-grid/card-grid.component';\r\n\r\ninterface HandViewModel {\r\n  cardStates: Record<string, CardState>;\r\n  myHandCount: number;\r\n  selectableCardIds: Set<string>;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-hand-selector',\r\n  standalone: true,\r\n  imports: [CommonModule, CardGridComponent],\r\n  templateUrl: './hand-selector.component.html',\r\n  styleUrls: ['./hand-selector.component.scss']\r\n})\r\nexport class HandSelectorComponent {\r\n  readonly emptyProbabilities: Record<number, number> = {};\r\n  readonly initialPhase = GamePhase.INITIAL_FOUR;\r\n\r\n  readonly vm$ = this.gameStateService.state.pipe(\r\n    map((state): HandViewModel => {\r\n      const selectableCardIds = new Set<string>();\r\n\r\n      for (const [cardId, cardState] of Object.entries(state.cardStates)) {\r\n        if (cardState === CardState.UNKNOWN || cardState === CardState.IN_MY_HAND) {\r\n          selectableCardIds.add(cardId);\r\n        }\r\n      }\r\n\r\n      return {\r\n        cardStates: state.cardStates,\r\n        myHandCount: state.myHand.length,\r\n        selectableCardIds\r\n      };\r\n    })\r\n  );\r\n\r\n  readonly phase$ = this.gameStateService.phase;\r\n\r\n  constructor(private readonly gameStateService: GameStateService) {}\r\n\r\n  onCardClicked(cardId: string): void {\r\n    this.gameStateService.clickHandCard(cardId);\r\n  }\r\n}\r\n","<div class=\"hand-wrap\" *ngIf=\"vm$ | async as vm\">\r\n  <h2>La mia mano ({{ vm.myHandCount }}/3)</h2>\r\n  <app-card-grid\r\n    mode=\"hand\"\r\n    [cardStates]=\"vm.cardStates\"\r\n    [probabilities]=\"emptyProbabilities\"\r\n    [selectableCardIds]=\"vm.selectableCardIds\"\r\n    [phase]=\"(phase$ | async) ?? initialPhase\"\r\n    (cardClicked)=\"onCardClicked($event)\"\r\n  />\r\n</div>\r\n","import { CommonModule } from '@angular/common';\r\nimport { Component } from '@angular/core';\r\nimport { map } from 'rxjs';\r\nimport { GameStateService } from '../../services/game-state.service';\r\n\r\n@Component({\r\n  selector: 'app-log-bar',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './log-bar.component.html',\r\n  styleUrls: ['./log-bar.component.scss']\r\n})\r\nexport class LogBarComponent {\r\n  readonly logText$ = this.gameStateService.lastPlayLog.pipe(\r\n    map((value) => value || 'Nessuna giocata ancora')\r\n  );\r\n\r\n  constructor(private readonly gameStateService: GameStateService) {}\r\n}\r\n","<div class=\"log-bar\">\r\n  <strong>Ultima giocata:</strong> {{ logText$ | async }}\r\n</div>\r\n","import { CommonModule } from '@angular/common';\r\nimport { Component } from '@angular/core';\r\nimport { map } from 'rxjs';\r\nimport { CARD_BY_ID, CardState, GamePhase, Suit } from '../../models/card.model';\r\nimport { GameStateService } from '../../services/game-state.service';\r\n\r\ninterface StatsViewModel {\r\n  denariPlayed: number;\r\n  totalPlayed: number;\r\n  remaining: number;\r\n  phaseLabel: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-stats-panel',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './stats-panel.component.html',\r\n  styleUrls: ['./stats-panel.component.scss']\r\n})\r\nexport class StatsPanelComponent {\r\n  readonly stats$ = this.gameStateService.state.pipe(\r\n    map((state): StatsViewModel => {\r\n      const playedIds = Object.entries(state.cardStates)\r\n        .filter(([, cardState]) => cardState === CardState.PLAYED)\r\n        .map(([cardId]) => cardId);\r\n\r\n      const denariPlayed = playedIds\r\n        .map((cardId) => CARD_BY_ID[cardId])\r\n        .filter((card) => card?.suit === Suit.Denari)\r\n        .length;\r\n\r\n      const totalPlayed = playedIds.length;\r\n\r\n      return {\r\n        denariPlayed,\r\n        totalPlayed,\r\n        remaining: 40 - totalPlayed,\r\n        phaseLabel: this.toPhaseLabel(state.phase)\r\n      };\r\n    })\r\n  );\r\n\r\n  constructor(private readonly gameStateService: GameStateService) {}\r\n\r\n  private toPhaseLabel(phase: GamePhase): string {\r\n    if (phase === GamePhase.INITIAL_FOUR) {\r\n      return 'Carte iniziali';\r\n    }\r\n\r\n    if (phase === GamePhase.PLAYING) {\r\n      return 'In gioco';\r\n    }\r\n\r\n    return 'Scegli combinazione';\r\n  }\r\n}\r\n","<div class=\"stats-row\" *ngIf=\"stats$ | async as stats\">\r\n  <div>Denari: {{ stats.denariPlayed }}/10</div>\r\n  <div>Totale uscite: {{ stats.totalPlayed }}/40</div>\r\n  <div>Rimaste: {{ stats.remaining }}</div>\r\n  <div>Fase: {{ stats.phaseLabel }}</div>\r\n</div>\r\n","import { CommonModule } from '@angular/common';\r\nimport { Component } from '@angular/core';\r\nimport { map } from 'rxjs';\r\nimport { GameStateService } from '../../services/game-state.service';\r\n\r\n@Component({\r\n  selector: 'app-toolbar',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './toolbar.component.html',\r\n  styleUrls: ['./toolbar.component.scss']\r\n})\r\nexport class ToolbarComponent {\r\n  readonly opponentCardCount$ = this.gameStateService.opponentCardCount;\r\n  readonly turn$ = this.gameStateService.turn;\r\n  readonly canUndo$ = this.gameStateService.state.pipe(map((state) => state.history.length > 0));\r\n\r\n  constructor(private readonly gameStateService: GameStateService) {}\r\n\r\n  cycleOpponentCards(current: number | null): void {\r\n    if (current === null) {\r\n      return;\r\n    }\r\n\r\n    const next = current === 3 ? 2 : current === 2 ? 1 : 3;\r\n    this.gameStateService.setOpponentCardCount(next);\r\n  }\r\n\r\n  reset(): void {\r\n    const confirmed = window.confirm('Confermi il reset della partita?');\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    this.gameStateService.reset();\r\n  }\r\n\r\n  undo(): void {\r\n    this.gameStateService.undo();\r\n  }\r\n\r\n  setTurn(turn: 'ME' | 'OPPONENT'): void {\r\n    this.gameStateService.setTurn(turn);\r\n  }\r\n}\r\n","<div class=\"toolbar-row\" *ngIf=\"{ opponent: (opponentCardCount$ | async), turn: (turn$ | async), canUndo: (canUndo$ | async) } as vm\">\r\n  <button\r\n    type=\"button\"\r\n    class=\"toolbar-btn\"\r\n    (click)=\"cycleOpponentCards(vm.opponent)\"\r\n  >\r\n    Carte avversario: {{ vm.opponent }}\r\n  </button>\r\n\r\n  <button type=\"button\" class=\"toolbar-btn reset-btn\" (click)=\"reset()\">Reset</button>\r\n\r\n  <button\r\n    type=\"button\"\r\n    class=\"toolbar-btn\"\r\n    [disabled]=\"!vm.canUndo\"\r\n    (click)=\"undo()\"\r\n  >\r\n     Undo\r\n  </button>\r\n\r\n  <button\r\n    type=\"button\"\r\n    class=\"toolbar-btn turn-btn\"\r\n    [class.active]=\"vm.turn === 'ME'\"\r\n    [disabled]=\"vm.turn !== null\"\r\n    (click)=\"setTurn('ME')\"\r\n  >\r\n    Tu\r\n  </button>\r\n\r\n  <button\r\n    type=\"button\"\r\n    class=\"toolbar-btn turn-btn\"\r\n    [class.active]=\"vm.turn === 'OPPONENT'\"\r\n    [disabled]=\"vm.turn !== null\"\r\n    (click)=\"setTurn('OPPONENT')\"\r\n  >\r\n    Avversario\r\n  </button>\r\n</div>\r\n","export enum Suit {\r\n  Denari = 'Denari',\r\n  Coppe = 'Coppe',\r\n  Spade = 'Spade',\r\n  Bastoni = 'Bastoni'\r\n}\r\n\r\nexport enum CardState {\r\n  UNKNOWN = 'UNKNOWN',\r\n  IN_MY_HAND = 'IN_MY_HAND',\r\n  ON_TABLE = 'ON_TABLE',\r\n  ON_TABLE_BLINKING = 'ON_TABLE_BLINKING',\r\n  PLAYED = 'PLAYED',\r\n  COMBINATION_CANDIDATE = 'COMBINATION_CANDIDATE'\r\n}\r\n\r\nexport enum GamePhase {\r\n  INITIAL_FOUR = 'INITIAL_FOUR',\r\n  PLAYING = 'PLAYING',\r\n  CHOOSE_COMBINATION = 'CHOOSE_COMBINATION'\r\n}\r\n\r\nexport type Turn = 'ME' | 'OPPONENT' | null;\r\n\r\nexport interface Card {\r\n  id: string;\r\n  suit: Suit;\r\n  rank: number;\r\n}\r\n\r\nexport interface GameStateSnapshot {\r\n  cardStates: Record<string, CardState>;\r\n  phase: GamePhase;\r\n  turn: Turn;\r\n  myHand: string[];\r\n  opponentCardCount: number;\r\n  cardsOnTable: string[];\r\n  initialFourCount: number;\r\n  lastPlayLog: string;\r\n  pendingPlayedCard: string | null;\r\n  selectedCombination: string[];\r\n}\r\n\r\nexport interface GameState extends GameStateSnapshot {\r\n  history: GameStateSnapshot[];\r\n  aiSuggestion: string;\r\n  aiLoading: boolean;\r\n}\r\n\r\nexport const SUITS: Suit[] = [Suit.Denari, Suit.Coppe, Suit.Spade, Suit.Bastoni];\r\n\r\nexport const RANKS: number[] = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\r\n\r\nexport function createCardId(suit: Suit, rank: number): string {\r\n  return `${suit.toLowerCase()}-${rank}`;\r\n}\r\n\r\nexport const ALL_CARDS: Card[] = SUITS.flatMap((suit) =>\r\n  RANKS.map((rank) => ({\r\n    id: createCardId(suit, rank),\r\n    suit,\r\n    rank\r\n  }))\r\n);\r\n\r\nexport const CARD_BY_ID: Record<string, Card> = ALL_CARDS.reduce<Record<string, Card>>((acc, card) => {\r\n  acc[card.id] = card;\r\n  return acc;\r\n}, {});\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport {\r\n  Observable,\r\n  Subject,\r\n  combineLatest,\r\n  debounceTime,\r\n  distinctUntilChanged,\r\n  filter,\r\n  finalize,\r\n  map,\r\n  of,\r\n  switchMap,\r\n  takeUntil,\r\n  tap,\r\n  catchError\r\n} from 'rxjs';\r\nimport { environment } from '../../environments/environment';\r\nimport {\r\n  CARD_BY_ID,\r\n  CardState,\r\n  GamePhase,\r\n  GameState\r\n} from '../models/card.model';\r\nimport { GameStateService } from './game-state.service';\r\nimport { OpenAIService, OpenAiQueryInput } from './openai.service';\r\nimport { ProbabilityService } from './probability.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AISuggestionService implements OnDestroy {\r\n  private readonly destroy$ = new Subject<void>();\r\n\r\n  private latestState: GameState | null = null;\r\n  private latestProbabilities = new Map<number, number>();\r\n\r\n  constructor(\r\n    private readonly gameStateService: GameStateService,\r\n    private readonly probabilityService: ProbabilityService,\r\n    private readonly openAiService: OpenAIService\r\n  ) {\r\n    combineLatest([\r\n      this.gameStateService.state,\r\n      this.probabilityService.probabilities$\r\n    ]).pipe(\r\n      takeUntil(this.destroy$),\r\n      tap(([state, probabilities]) => {\r\n        this.latestState = state;\r\n        this.latestProbabilities = probabilities;\r\n      }),\r\n      map(([state, probabilities]) => ({\r\n        state,\r\n        probabilities,\r\n        key: this.buildTriggerKey(state, probabilities)\r\n      })),\r\n      distinctUntilChanged((a, b) => a.key === b.key),\r\n      filter(({ state }) =>\r\n        state.turn === 'ME' &&\r\n        state.myHand.length > 0 &&\r\n        state.phase === GamePhase.PLAYING\r\n      ),\r\n      debounceTime(1000),\r\n      switchMap(({ state, probabilities }) => this.executeQuery(state, probabilities))\r\n    ).subscribe();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.destroy$.next();\r\n    this.destroy$.complete();\r\n  }\r\n\r\n  manualQuery(): void {\r\n    const state = this.latestState;\r\n    if (!state) {\r\n      return;\r\n    }\r\n\r\n    this.executeQuery(state, this.latestProbabilities).subscribe();\r\n  }\r\n\r\n  isApiConfigured(): boolean {\n    const endpoint = environment.openaiProxyUrl.trim();\n    return endpoint.length > 0 && endpoint !== 'YOUR_BACKEND_ENDPOINT_HERE';\n  }\n\r\n  private executeQuery(state: GameState, probabilities: Map<number, number>): Observable<void> {\r\n    if (!this.isApiConfigured()) {\n      this.gameStateService.setAiLoading(false);\n      this.gameStateService.setAiSuggestion('Configura endpoint backend OpenAI in environment.ts');\n      return of(void 0);\n    }\n\r\n    if (!(state.turn === 'ME' && state.myHand.length > 0 && state.phase === GamePhase.PLAYING)) {\r\n      this.gameStateService.setAiLoading(false);\r\n      return of(void 0);\r\n    }\r\n\r\n    const input = this.buildQueryInput(state, probabilities);\r\n\r\n    this.gameStateService.setAiLoading(true);\r\n\r\n    return this.openAiService.queryBestMove(input).pipe(\r\n      tap((suggestion) => {\r\n        this.gameStateService.setAiSuggestion(suggestion);\r\n      }),\r\n      catchError(() => {\r\n        this.gameStateService.setAiSuggestion('Errore durante la richiesta a OpenAI.');\r\n        return of('');\r\n      }),\r\n      finalize(() => {\r\n        this.gameStateService.setAiLoading(false);\r\n      }),\r\n      map(() => void 0)\r\n    );\r\n  }\r\n\r\n  private buildQueryInput(state: GameState, probabilities: Map<number, number>): OpenAiQueryInput {\r\n    const probabilitiesByRank: Record<number, number> = {};\r\n    for (let rank = 1; rank <= 10; rank += 1) {\r\n      probabilitiesByRank[rank] = probabilities.get(rank) ?? 0;\r\n    }\r\n\r\n    const playedStates = new Set<CardState>([\r\n      CardState.PLAYED,\r\n      CardState.ON_TABLE,\r\n      CardState.ON_TABLE_BLINKING,\r\n      CardState.COMBINATION_CANDIDATE\r\n    ]);\r\n\r\n    const playedCards = Object.entries(state.cardStates)\r\n      .filter(([, cardState]) => playedStates.has(cardState))\r\n      .map(([cardId]) => this.cardLabel(cardId));\r\n\r\n    const unknownCardsCount = Object.values(state.cardStates).filter((cardState) => cardState === CardState.UNKNOWN).length;\r\n\r\n    return {\r\n      myHand: state.myHand.map((cardId) => this.cardLabel(cardId)),\r\n      cardsOnTable: state.cardsOnTable.map((cardId) => this.cardLabel(cardId)),\r\n      playedCards,\r\n      unknownCardsCount,\r\n      probabilitiesByRank,\r\n      opponentCardCount: state.opponentCardCount\r\n    };\r\n  }\r\n\r\n  private buildTriggerKey(state: GameState, probabilities: Map<number, number>): string {\r\n    const probabilityVector = Array.from({ length: 10 }, (_, index) => probabilities.get(index + 1) ?? 0);\r\n\r\n    return JSON.stringify({\r\n      cardStates: state.cardStates,\r\n      phase: state.phase,\r\n      turn: state.turn,\r\n      myHand: state.myHand,\r\n      cardsOnTable: state.cardsOnTable,\r\n      opponentCardCount: state.opponentCardCount,\r\n      pendingPlayedCard: state.pendingPlayedCard,\r\n      selectedCombination: state.selectedCombination,\r\n      probabilityVector\r\n    });\r\n  }\r\n\r\n  private cardLabel(cardId: string): string {\r\n    const card = CARD_BY_ID[cardId];\r\n    if (!card) {\r\n      return cardId;\r\n    }\r\n\r\n    return `${this.rankLabel(card.rank)} di ${card.suit}`;\r\n  }\r\n\r\n  private rankLabel(rank: number): string {\r\n    if (rank === 1) {\r\n      return 'Asso';\r\n    }\r\n    if (rank === 8) {\r\n      return 'Donna';\r\n    }\r\n    if (rank === 9) {\r\n      return 'Cavallo';\r\n    }\r\n    if (rank === 10) {\r\n      return 'Re';\r\n    }\r\n    return rank.toString();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  CARD_BY_ID,\r\n  Card,\r\n  CardState,\r\n  GamePhase,\r\n  GameStateSnapshot,\r\n  Turn\r\n} from '../models/card.model';\r\nimport { findCombinations } from '../utils/combinations.util';\r\n\r\nexport interface TrackerResult {\r\n  error: string | null;\r\n  shouldToggleTurn: boolean;\r\n  shouldDecrementOpponent: boolean;\r\n  didMutate: boolean;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CardTrackerService {\r\n  handleTableCardClick(snapshot: GameStateSnapshot, cardId: string): TrackerResult {\r\n    const card = CARD_BY_ID[cardId];\r\n    if (!card) {\r\n      return this.errorResult('Carta non valida');\r\n    }\r\n\r\n    if (snapshot.phase === GamePhase.INITIAL_FOUR) {\r\n      const didMutate = this.handleInitialFour(snapshot, cardId);\r\n      return this.okResult(didMutate);\r\n    }\r\n\r\n    if (snapshot.phase !== GamePhase.PLAYING) {\r\n      return this.errorResult('Seleziona una combinazione valida');\r\n    }\r\n\r\n    if (snapshot.turn === null) {\r\n      return this.errorResult('Seleziona chi gioca per primo');\r\n    }\r\n\r\n    const cardState = snapshot.cardStates[cardId];\r\n    if (snapshot.turn === 'ME') {\r\n      if (cardState !== CardState.IN_MY_HAND) {\r\n        return this.errorResult('Questa carta non e nella tua mano');\r\n      }\r\n    } else if (cardState !== CardState.UNKNOWN) {\r\n      return this.errorResult('Carta non selezionabile per l\\'avversario');\r\n    }\r\n\r\n    return this.handlePlay(snapshot, card);\r\n  }\r\n\r\n  handleCombinationSelection(snapshot: GameStateSnapshot, cardId: string): TrackerResult {\r\n    if (snapshot.phase !== GamePhase.CHOOSE_COMBINATION || !snapshot.pendingPlayedCard) {\r\n      return this.errorResult('Nessuna combinazione da selezionare');\r\n    }\r\n\r\n    const state = snapshot.cardStates[cardId];\r\n    if (state !== CardState.ON_TABLE && state !== CardState.COMBINATION_CANDIDATE) {\r\n      return this.errorResult('Carta non selezionabile per la combinazione');\r\n    }\r\n\r\n    if (state === CardState.ON_TABLE) {\r\n      snapshot.cardStates[cardId] = CardState.COMBINATION_CANDIDATE;\r\n      if (!snapshot.selectedCombination.includes(cardId)) {\r\n        snapshot.selectedCombination = [...snapshot.selectedCombination, cardId];\r\n      }\r\n    } else {\r\n      snapshot.cardStates[cardId] = CardState.ON_TABLE;\r\n      snapshot.selectedCombination = snapshot.selectedCombination.filter((id) => id !== cardId);\r\n    }\r\n\r\n    const pending = CARD_BY_ID[snapshot.pendingPlayedCard];\r\n    if (!pending) {\r\n      return this.errorResult('Carta giocata in attesa non valida');\r\n    }\r\n\r\n    const selectedCards = snapshot.selectedCombination\r\n      .map((id) => CARD_BY_ID[id])\r\n      .filter((card): card is Card => !!card);\r\n    const selectedSum = selectedCards.reduce((acc, card) => acc + card.rank, 0);\r\n\r\n    const tableCards = snapshot.cardsOnTable\r\n      .map((id) => CARD_BY_ID[id])\r\n      .filter((tableCard): tableCard is Card => !!tableCard);\r\n    const validCombinations = findCombinations(pending.rank, tableCards);\r\n\r\n    const isValidSelection = this.matchesAnyCombination(snapshot.selectedCombination, validCombinations);\r\n\r\n    if (selectedSum !== pending.rank || !isValidSelection) {\r\n      return this.okResult(true);\r\n    }\r\n\r\n    for (const selectedId of snapshot.selectedCombination) {\r\n      snapshot.cardStates[selectedId] = CardState.PLAYED;\r\n    }\r\n\r\n    snapshot.cardStates[snapshot.pendingPlayedCard] = CardState.PLAYED;\r\n    snapshot.cardsOnTable = snapshot.cardsOnTable.filter((id) => !snapshot.selectedCombination.includes(id));\r\n\r\n    const actor = this.actorLabel(snapshot.turn);\r\n    const selectedLabel = snapshot.selectedCombination\r\n      .map((id) => CARD_BY_ID[id])\r\n      .filter((card): card is Card => !!card)\r\n      .map((card) => this.cardLabel(card))\r\n      .join(', ');\r\n    snapshot.lastPlayLog = `${actor} gioca ${this.cardLabel(pending)}, prende ${selectedLabel}`;\r\n\r\n    if (snapshot.myHand.includes(snapshot.pendingPlayedCard)) {\r\n      snapshot.myHand = snapshot.myHand.filter((id) => id !== snapshot.pendingPlayedCard);\r\n    }\r\n\r\n    snapshot.pendingPlayedCard = null;\r\n    snapshot.selectedCombination = [];\r\n    snapshot.phase = GamePhase.PLAYING;\r\n\r\n    return {\r\n      error: null,\r\n      shouldToggleTurn: true,\r\n      shouldDecrementOpponent: false,\r\n      didMutate: true\r\n    };\r\n  }\r\n\r\n  private handleInitialFour(snapshot: GameStateSnapshot, cardId: string): boolean {\r\n    const current = snapshot.cardStates[cardId];\r\n\r\n    if (current === CardState.UNKNOWN) {\r\n      snapshot.cardStates[cardId] = CardState.ON_TABLE;\r\n      if (!snapshot.cardsOnTable.includes(cardId)) {\r\n        snapshot.cardsOnTable = [...snapshot.cardsOnTable, cardId];\r\n      }\r\n      snapshot.initialFourCount += 1;\r\n      snapshot.phase = snapshot.initialFourCount >= 4 ? GamePhase.PLAYING : GamePhase.INITIAL_FOUR;\r\n      return true;\r\n    }\r\n\r\n    if (current === CardState.ON_TABLE) {\r\n      snapshot.cardStates[cardId] = CardState.UNKNOWN;\r\n      snapshot.cardsOnTable = snapshot.cardsOnTable.filter((id) => id !== cardId);\r\n      snapshot.initialFourCount = Math.max(0, snapshot.initialFourCount - 1);\r\n      snapshot.phase = snapshot.initialFourCount >= 4 ? GamePhase.PLAYING : GamePhase.INITIAL_FOUR;\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  private handlePlay(snapshot: GameStateSnapshot, playedCard: Card): TrackerResult {\r\n    const actor = this.actorLabel(snapshot.turn);\r\n    const isMyPlay = snapshot.turn === 'ME';\r\n\r\n    const tableCards = snapshot.cardsOnTable\r\n      .map((id) => CARD_BY_ID[id])\r\n      .filter((card): card is Card => !!card);\r\n\r\n    const combinations = findCombinations(playedCard.rank, tableCards);\r\n\r\n    if (combinations.length === 0) {\r\n      snapshot.cardStates[playedCard.id] = CardState.ON_TABLE;\r\n      if (!snapshot.cardsOnTable.includes(playedCard.id)) {\r\n        snapshot.cardsOnTable = [...snapshot.cardsOnTable, playedCard.id];\r\n      }\r\n      if (isMyPlay) {\r\n        snapshot.myHand = snapshot.myHand.filter((id) => id !== playedCard.id);\r\n      }\r\n\r\n      snapshot.lastPlayLog = `${actor} gioca ${this.cardLabel(playedCard)}, nessuna presa`;\r\n      return {\r\n        error: null,\r\n        shouldToggleTurn: true,\r\n        shouldDecrementOpponent: snapshot.turn === 'OPPONENT',\r\n        didMutate: true\r\n      };\r\n    }\r\n\r\n    if (combinations.length === 1) {\r\n      const combo = combinations[0];\r\n      const comboIds = combo.map((card) => card.id);\r\n\r\n      for (const comboId of comboIds) {\r\n        snapshot.cardStates[comboId] = CardState.PLAYED;\r\n      }\r\n      snapshot.cardStates[playedCard.id] = CardState.PLAYED;\r\n      snapshot.cardsOnTable = snapshot.cardsOnTable.filter((id) => !comboIds.includes(id));\r\n\r\n      if (isMyPlay) {\r\n        snapshot.myHand = snapshot.myHand.filter((id) => id !== playedCard.id);\r\n      }\r\n\r\n      const capturedLabel = combo.map((card) => this.cardLabel(card)).join(', ');\r\n      snapshot.lastPlayLog = `${actor} gioca ${this.cardLabel(playedCard)}, prende ${capturedLabel}`;\r\n      return {\r\n        error: null,\r\n        shouldToggleTurn: true,\r\n        shouldDecrementOpponent: snapshot.turn === 'OPPONENT',\r\n        didMutate: true\r\n      };\r\n    }\r\n\r\n    snapshot.phase = GamePhase.CHOOSE_COMBINATION;\r\n    snapshot.cardStates[playedCard.id] = CardState.ON_TABLE_BLINKING;\r\n    snapshot.pendingPlayedCard = playedCard.id;\r\n    snapshot.selectedCombination = [];\r\n    snapshot.lastPlayLog = `${actor} gioca ${this.cardLabel(playedCard)}, selezionare combinazione`;\r\n\r\n    return {\r\n      error: null,\r\n      shouldToggleTurn: false,\r\n      shouldDecrementOpponent: snapshot.turn === 'OPPONENT',\r\n      didMutate: true\r\n    };\r\n  }\r\n\r\n  private matchesAnyCombination(selectedIds: string[], combinations: Card[][]): boolean {\r\n    if (selectedIds.length === 0) {\r\n      return false;\r\n    }\r\n\r\n    const selectedKey = [...selectedIds].sort().join('|');\r\n\r\n    return combinations.some((combination) => {\r\n      const comboKey = combination\r\n        .map((card) => card.id)\r\n        .sort()\r\n        .join('|');\r\n      return comboKey === selectedKey;\r\n    });\r\n  }\r\n\r\n  private actorLabel(turn: Turn): string {\r\n    return turn === 'ME' ? 'Tu' : 'Avversario';\r\n  }\r\n\r\n  private cardLabel(card: Card): string {\r\n    return `${this.rankLabel(card.rank)} di ${card.suit}`;\r\n  }\r\n\r\n  private rankLabel(rank: number): string {\r\n    if (rank === 1) {\r\n      return 'Asso';\r\n    }\r\n    if (rank === 8) {\r\n      return 'Donna';\r\n    }\r\n    if (rank === 9) {\r\n      return 'Cavallo';\r\n    }\r\n    if (rank === 10) {\r\n      return 'Re';\r\n    }\r\n    return rank.toString();\r\n  }\r\n\r\n  private errorResult(message: string): TrackerResult {\r\n    return {\r\n      error: message,\r\n      shouldToggleTurn: false,\r\n      shouldDecrementOpponent: false,\r\n      didMutate: false\r\n    };\r\n  }\r\n\r\n  private okResult(didMutate: boolean): TrackerResult {\r\n    return {\r\n      error: null,\r\n      shouldToggleTurn: false,\r\n      shouldDecrementOpponent: false,\r\n      didMutate\r\n    };\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, map } from 'rxjs';\r\nimport {\r\n  ALL_CARDS,\r\n  CARD_BY_ID,\r\n  CardState,\r\n  GamePhase,\r\n  GameState,\r\n  GameStateSnapshot,\r\n  Turn\r\n} from '../models/card.model';\r\nimport { CardTrackerService } from './card-tracker.service';\r\nimport { LocalStorageService } from './local-storage.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GameStateService {\r\n  private readonly storageKey = 'state';\r\n  private readonly stateSubject = new BehaviorSubject<GameState>(this.createInitialState());\r\n\r\n  readonly state: Observable<GameState> = this.stateSubject.asObservable();\r\n  readonly cardStates = this.state.pipe(map((state) => state.cardStates));\r\n  readonly phase = this.state.pipe(map((state) => state.phase));\r\n  readonly turn = this.state.pipe(map((state) => state.turn));\r\n  readonly myHand = this.state.pipe(map((state) => state.myHand));\r\n  readonly opponentCardCount = this.state.pipe(map((state) => state.opponentCardCount));\r\n  readonly cardsOnTable = this.state.pipe(map((state) => state.cardsOnTable));\r\n  readonly lastPlayLog = this.state.pipe(map((state) => state.lastPlayLog));\r\n  readonly aiSuggestion = this.state.pipe(map((state) => state.aiSuggestion));\r\n  readonly aiLoading = this.state.pipe(map((state) => state.aiLoading));\r\n\r\n  constructor(\r\n    private readonly cardTracker: CardTrackerService,\r\n    private readonly localStorageService: LocalStorageService\r\n  ) {\r\n    this.stateSubject.next(this.restoreState());\r\n  }\r\n\r\n  getCurrentState(): GameState {\r\n    return this.stateSubject.value;\r\n  }\r\n\r\n  reset(): void {\r\n    const next = this.createInitialState();\r\n    this.commit(next);\r\n  }\r\n\r\n  undo(): void {\r\n    const current = this.stateSubject.value;\r\n    if (current.history.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const previous = current.history[current.history.length - 1];\r\n    const restored = this.cloneSnapshot(previous);\r\n\r\n    const next: GameState = {\r\n      ...restored,\r\n      history: current.history.slice(0, -1).map((snapshot) => this.cloneSnapshot(snapshot)),\r\n      aiSuggestion: current.aiSuggestion,\r\n      aiLoading: current.aiLoading\r\n    };\r\n\r\n    this.commit(next);\r\n  }\r\n\r\n  setTurn(turn: Exclude<Turn, null>): void {\n    this.applyMutation((draft) => {\n      if (draft.turn !== null) {\n        return false;\n      }\n\n      this.setTurnWithOpponentRefill(draft, turn);\n      return true;\n    });\n  }\n\r\n  toggleTurn(): void {\n    this.applyMutation((draft) => {\n      if (draft.turn === null) {\n        return false;\n      }\n\n      const nextTurn = draft.turn === 'ME' ? 'OPPONENT' : 'ME';\n      this.setTurnWithOpponentRefill(draft, nextTurn);\n      return true;\n    });\n  }\n\r\n  clickTableCard(cardId: string): string | null {\r\n    let error: string | null = null;\r\n\r\n    this.applyMutation((draft) => {\r\n      const result = this.cardTracker.handleTableCardClick(draft, cardId);\r\n      if (result.error) {\r\n        error = result.error;\r\n        return false;\r\n      }\r\n\r\n      if (!result.didMutate) {\r\n        return false;\r\n      }\r\n\r\n      if (result.shouldDecrementOpponent) {\r\n        draft.opponentCardCount = Math.max(0, draft.opponentCardCount - 1);\r\n      }\r\n\r\n      if (result.shouldToggleTurn) {\n        const nextTurn = draft.turn === 'ME' ? 'OPPONENT' : 'ME';\n        this.setTurnWithOpponentRefill(draft, nextTurn);\n      }\n\r\n      return true;\r\n    });\r\n\r\n    return error;\r\n  }\r\n\r\n  clickHandCard(cardId: string): void {\r\n    this.applyMutation((draft) => {\r\n      const current = draft.cardStates[cardId];\r\n      if (!current) {\r\n        return false;\r\n      }\r\n\r\n      if (current === CardState.PLAYED || current === CardState.ON_TABLE || current === CardState.ON_TABLE_BLINKING || current === CardState.COMBINATION_CANDIDATE) {\r\n        return false;\r\n      }\r\n\r\n      if (current === CardState.IN_MY_HAND) {\r\n        draft.cardStates[cardId] = CardState.UNKNOWN;\r\n        draft.myHand = draft.myHand.filter((id) => id !== cardId);\r\n        return true;\r\n      }\r\n\r\n      if (current === CardState.UNKNOWN && draft.myHand.length < 3) {\r\n        draft.cardStates[cardId] = CardState.IN_MY_HAND;\r\n        draft.myHand = [...draft.myHand, cardId];\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    });\r\n  }\r\n\r\n  selectCombinationCard(cardId: string): string | null {\r\n    let error: string | null = null;\r\n\r\n    this.applyMutation((draft) => {\r\n      const result = this.cardTracker.handleCombinationSelection(draft, cardId);\r\n      if (result.error) {\r\n        error = result.error;\r\n        return false;\r\n      }\r\n\r\n      if (!result.didMutate) {\r\n        return false;\r\n      }\r\n\r\n      if (result.shouldToggleTurn) {\n        const nextTurn = draft.turn === 'ME' ? 'OPPONENT' : 'ME';\n        this.setTurnWithOpponentRefill(draft, nextTurn);\n      }\n\r\n      return true;\r\n    });\r\n\r\n    return error;\r\n  }\r\n\r\n  setOpponentCardCount(value: number): void {\r\n    const nextValue = this.clamp(Math.round(value), 0, 3);\r\n\r\n    this.applyMutation((draft) => {\r\n      if (draft.opponentCardCount === nextValue) {\r\n        return false;\r\n      }\r\n\r\n      draft.opponentCardCount = nextValue;\r\n      return true;\r\n    });\r\n  }\r\n\r\n  decrementOpponentCards(): void {\r\n    this.applyMutation((draft) => {\r\n      const next = Math.max(0, draft.opponentCardCount - 1);\r\n      if (next === draft.opponentCardCount) {\r\n        return false;\r\n      }\r\n\r\n      draft.opponentCardCount = next;\r\n      return true;\r\n    });\r\n  }\r\n\r\n  setAiSuggestion(suggestion: string): void {\r\n    this.applyMutation((draft) => {\r\n      if (draft.aiSuggestion === suggestion) {\r\n        return false;\r\n      }\r\n\r\n      draft.aiSuggestion = suggestion;\r\n      return true;\r\n    });\r\n  }\r\n\r\n  setAiLoading(loading: boolean): void {\r\n    this.applyMutation((draft) => {\r\n      if (draft.aiLoading === loading) {\r\n        return false;\r\n      }\r\n\r\n      draft.aiLoading = loading;\r\n      return true;\r\n    });\r\n  }\r\n\r\n  private applyMutation(mutator: (draft: GameState) => boolean): void {\r\n    const current = this.stateSubject.value;\r\n    const draft = this.cloneState(current);\r\n    const didMutate = mutator(draft);\r\n\r\n    if (!didMutate) {\r\n      return;\r\n    }\r\n\r\n    draft.history.push(this.cloneSnapshot(this.toSnapshot(current)));\r\n    this.commit(draft);\r\n  }\r\n\r\n  private commit(state: GameState): void {\r\n    this.stateSubject.next(state);\r\n    this.localStorageService.save(this.storageKey, state);\r\n  }\r\n\r\n  private restoreState(): GameState {\r\n    const loaded = this.localStorageService.load<Partial<GameState>>(this.storageKey);\r\n    if (!loaded) {\r\n      return this.createInitialState();\r\n    }\r\n\r\n    return this.normalizeState(loaded);\r\n  }\r\n\r\n  private normalizeState(raw: Partial<GameState>): GameState {\r\n    const snapshot = this.normalizeSnapshot(raw);\r\n    const historyRaw = Array.isArray(raw.history) ? raw.history : [];\r\n    const history = historyRaw.map((item) => this.normalizeSnapshot(item));\r\n\r\n    return {\r\n      ...snapshot,\r\n      history,\r\n      aiSuggestion: typeof raw.aiSuggestion === 'string' ? raw.aiSuggestion : '',\r\n      aiLoading: typeof raw.aiLoading === 'boolean' ? raw.aiLoading : false\r\n    };\r\n  }\r\n\r\n  private normalizeSnapshot(raw: Partial<GameStateSnapshot>): GameStateSnapshot {\r\n    const initial = this.createInitialSnapshot();\r\n    const cardStates: Record<string, CardState> = {};\r\n    const validStates = new Set(Object.values(CardState));\r\n\r\n    for (const card of ALL_CARDS) {\r\n      const value = raw.cardStates?.[card.id];\r\n      cardStates[card.id] = validStates.has(value as CardState)\r\n        ? (value as CardState)\r\n        : CardState.UNKNOWN;\r\n    }\r\n\r\n    const phaseValues = new Set(Object.values(GamePhase));\r\n    const phase = phaseValues.has(raw.phase as GamePhase)\r\n      ? (raw.phase as GamePhase)\r\n      : GamePhase.INITIAL_FOUR;\r\n\r\n    const turn = raw.turn === 'ME' || raw.turn === 'OPPONENT' ? raw.turn : null;\r\n\r\n    const myHand = this.uniqueIds(Array.isArray(raw.myHand) ? raw.myHand : []).filter((id) => id in CARD_BY_ID).slice(0, 3);\r\n    const cardsOnTable = this.uniqueIds(Array.isArray(raw.cardsOnTable) ? raw.cardsOnTable : []).filter((id) => id in CARD_BY_ID);\r\n    const selectedCombination = this.uniqueIds(Array.isArray(raw.selectedCombination) ? raw.selectedCombination : []).filter((id) => id in CARD_BY_ID);\r\n\r\n    for (const id of myHand) {\r\n      if (cardStates[id] === CardState.UNKNOWN) {\r\n        cardStates[id] = CardState.IN_MY_HAND;\r\n      }\r\n    }\r\n\r\n    for (const id of cardsOnTable) {\r\n      if (cardStates[id] === CardState.UNKNOWN) {\r\n        cardStates[id] = CardState.ON_TABLE;\r\n      }\r\n    }\r\n\r\n    const pendingPlayedCard = typeof raw.pendingPlayedCard === 'string' && raw.pendingPlayedCard in CARD_BY_ID\r\n      ? raw.pendingPlayedCard\r\n      : null;\r\n\r\n    if (pendingPlayedCard && cardStates[pendingPlayedCard] === CardState.UNKNOWN) {\r\n      cardStates[pendingPlayedCard] = CardState.ON_TABLE_BLINKING;\r\n    }\r\n\r\n    for (const id of selectedCombination) {\r\n      if (cardStates[id] === CardState.ON_TABLE) {\r\n        cardStates[id] = CardState.COMBINATION_CANDIDATE;\r\n      }\r\n    }\r\n\r\n    return {\r\n      ...initial,\r\n      cardStates,\r\n      phase,\r\n      turn,\r\n      myHand,\r\n      opponentCardCount: this.clamp(\r\n        typeof raw.opponentCardCount === 'number' ? Math.round(raw.opponentCardCount) : 3,\r\n        0,\r\n        3\r\n      ),\r\n      cardsOnTable,\r\n      initialFourCount: this.clamp(\r\n        typeof raw.initialFourCount === 'number' ? Math.round(raw.initialFourCount) : cardsOnTable.length,\r\n        0,\r\n        4\r\n      ),\r\n      lastPlayLog: typeof raw.lastPlayLog === 'string' ? raw.lastPlayLog : '',\r\n      pendingPlayedCard,\r\n      selectedCombination\r\n    };\r\n  }\r\n\r\n  private createInitialState(): GameState {\r\n    return {\r\n      ...this.createInitialSnapshot(),\r\n      history: [],\r\n      aiSuggestion: '',\r\n      aiLoading: false\r\n    };\r\n  }\r\n\r\n  private createInitialSnapshot(): GameStateSnapshot {\r\n    const cardStates: Record<string, CardState> = {};\r\n\r\n    for (const card of ALL_CARDS) {\r\n      cardStates[card.id] = CardState.UNKNOWN;\r\n    }\r\n\r\n    return {\r\n      cardStates,\r\n      phase: GamePhase.INITIAL_FOUR,\r\n      turn: null,\r\n      myHand: [],\r\n      opponentCardCount: 3,\r\n      cardsOnTable: [],\r\n      initialFourCount: 0,\r\n      lastPlayLog: '',\r\n      pendingPlayedCard: null,\r\n      selectedCombination: []\r\n    };\r\n  }\r\n\r\n  private toSnapshot(state: GameState): GameStateSnapshot {\r\n    return {\r\n      cardStates: { ...state.cardStates },\r\n      phase: state.phase,\r\n      turn: state.turn,\r\n      myHand: [...state.myHand],\r\n      opponentCardCount: state.opponentCardCount,\r\n      cardsOnTable: [...state.cardsOnTable],\r\n      initialFourCount: state.initialFourCount,\r\n      lastPlayLog: state.lastPlayLog,\r\n      pendingPlayedCard: state.pendingPlayedCard,\r\n      selectedCombination: [...state.selectedCombination]\r\n    };\r\n  }\r\n\r\n  private cloneSnapshot(snapshot: GameStateSnapshot): GameStateSnapshot {\r\n    return {\r\n      cardStates: { ...snapshot.cardStates },\r\n      phase: snapshot.phase,\r\n      turn: snapshot.turn,\r\n      myHand: [...snapshot.myHand],\r\n      opponentCardCount: snapshot.opponentCardCount,\r\n      cardsOnTable: [...snapshot.cardsOnTable],\r\n      initialFourCount: snapshot.initialFourCount,\r\n      lastPlayLog: snapshot.lastPlayLog,\r\n      pendingPlayedCard: snapshot.pendingPlayedCard,\r\n      selectedCombination: [...snapshot.selectedCombination]\r\n    };\r\n  }\r\n\r\n  private cloneState(state: GameState): GameState {\r\n    return {\r\n      ...this.cloneSnapshot(state),\r\n      history: state.history.map((snapshot) => this.cloneSnapshot(snapshot)),\r\n      aiSuggestion: state.aiSuggestion,\r\n      aiLoading: state.aiLoading\r\n    };\r\n  }\r\n\r\n  private uniqueIds(ids: string[]): string[] {\n    return [...new Set(ids)];\n  }\n\n  private setTurnWithOpponentRefill(draft: GameState, turn: Exclude<Turn, null>): void {\n    draft.turn = turn;\n\n    if (turn === 'OPPONENT' && draft.opponentCardCount === 0) {\n      draft.opponentCardCount = 3;\n    }\n  }\n\n  private clamp(value: number, min: number, max: number): number {\n    return Math.max(min, Math.min(max, value));\n  }\n}\n\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LocalStorageService {\r\n  private readonly prefix = 'scopa_ng_';\r\n\r\n  save<T>(key: string, data: T): void {\r\n    try {\r\n      localStorage.setItem(this.buildKey(key), JSON.stringify(data));\r\n    } catch {\r\n      // Storage may be unavailable, fail silently.\r\n    }\r\n  }\r\n\r\n  load<T>(key: string): T | null {\r\n    try {\r\n      const raw = localStorage.getItem(this.buildKey(key));\r\n      if (!raw) {\r\n        return null;\r\n      }\r\n\r\n      return JSON.parse(raw) as T;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  remove(key: string): void {\r\n    try {\r\n      localStorage.removeItem(this.buildKey(key));\r\n    } catch {\r\n      // Storage may be unavailable, fail silently.\r\n    }\r\n  }\r\n\r\n  private buildKey(key: string): string {\r\n    return `${this.prefix}${key}`;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { map, Observable } from 'rxjs';\nimport { environment } from '../../environments/environment';\n\r\nexport interface OpenAiQueryInput {\r\n  myHand: string[];\r\n  cardsOnTable: string[];\r\n  playedCards: string[];\r\n  unknownCardsCount: number;\r\n  probabilitiesByRank: Record<number, number>;\r\n  opponentCardCount: number;\r\n}\r\n\r\ninterface SuggestionResponse {\n  suggestion?: string;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OpenAIService {\n  private readonly endpoint = environment.openaiProxyUrl;\n\n  constructor(private readonly http: HttpClient) {}\n\n  queryBestMove(input: OpenAiQueryInput): Observable<string> {\n    return this.http.post<SuggestionResponse>(\n      this.endpoint,\n      input\n    ).pipe(\n      map((response) => response.suggestion?.trim() || 'Nessun suggerimento disponibile.')\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\r\nimport { Observable, combineLatest, map, shareReplay } from 'rxjs';\r\nimport { CARD_BY_ID, CardState, RANKS } from '../models/card.model';\r\nimport { GameStateService } from './game-state.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ProbabilityService {\r\n  readonly probabilities$: Observable<Map<number, number>>;\r\n\r\n  constructor(private readonly gameStateService: GameStateService) {\r\n    this.probabilities$ = combineLatest([\r\n      this.gameStateService.cardStates,\r\n      this.gameStateService.opponentCardCount\r\n    ]).pipe(\r\n      map(([cardStates, opponentCardCount]) => this.computeProbabilities(cardStates, opponentCardCount)),\r\n      shareReplay({ bufferSize: 1, refCount: true })\r\n    );\r\n  }\r\n\r\n  private computeProbabilities(\r\n    cardStates: Record<string, CardState>,\r\n    opponentCardCount: number\r\n  ): Map<number, number> {\r\n    const unknownByRank = new Map<number, number>();\r\n    for (const rank of RANKS) {\r\n      unknownByRank.set(rank, 0);\r\n    }\r\n\r\n    let totalUnknown = 0;\r\n\r\n    for (const [cardId, state] of Object.entries(cardStates)) {\r\n      if (state !== CardState.UNKNOWN) {\r\n        continue;\r\n      }\r\n\r\n      const card = CARD_BY_ID[cardId];\r\n      if (!card) {\r\n        continue;\r\n      }\r\n\r\n      totalUnknown += 1;\r\n      unknownByRank.set(card.rank, (unknownByRank.get(card.rank) ?? 0) + 1);\r\n    }\r\n\r\n    const result = new Map<number, number>();\r\n\r\n    if (opponentCardCount <= 0 || totalUnknown <= 0) {\r\n      for (const rank of RANKS) {\r\n        result.set(rank, 0);\r\n      }\r\n      return result;\r\n    }\r\n\r\n    const drawSize = Math.min(opponentCardCount, totalUnknown);\r\n\r\n    for (const rank of RANKS) {\r\n      const unknownOfRank = unknownByRank.get(rank) ?? 0;\r\n      if (unknownOfRank <= 0) {\r\n        result.set(rank, 0);\r\n        continue;\r\n      }\r\n\r\n      const denominator = this.combinations(totalUnknown, drawSize);\r\n      const numerator = this.combinations(totalUnknown - unknownOfRank, drawSize);\r\n\r\n      if (denominator <= 0) {\r\n        result.set(rank, 0);\r\n        continue;\r\n      }\r\n\r\n      result.set(rank, 1 - (numerator / denominator));\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  private combinations(n: number, k: number): number {\r\n    if (k < 0 || k > n) {\r\n      return 0;\r\n    }\r\n\r\n    if (k === 0 || k === n) {\r\n      return 1;\r\n    }\r\n\r\n    const kk = Math.min(k, n - k);\r\n    let result = 1;\r\n\r\n    for (let i = 1; i <= kk; i += 1) {\r\n      result = (result * (n - kk + i)) / i;\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","import { Card } from '../models/card.model';\r\n\r\nexport function findCombinations(targetSum: number, tableCards: Card[]): Card[][] {\r\n  if (targetSum <= 0 || tableCards.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const combinations: Card[][] = [];\r\n  const n = tableCards.length;\r\n  const maxMask = 1 << n;\r\n\r\n  for (let mask = 1; mask < maxMask; mask += 1) {\r\n    let sum = 0;\r\n    const subset: Card[] = [];\r\n\r\n    for (let i = 0; i < n; i += 1) {\r\n      if ((mask & (1 << i)) === 0) {\r\n        continue;\r\n      }\r\n\r\n      const card = tableCards[i];\r\n      subset.push(card);\r\n      sum += card.rank;\r\n    }\r\n\r\n    if (sum === targetSum) {\r\n      combinations.push(subset);\r\n    }\r\n  }\r\n\r\n  return combinations;\r\n}\r\n","export const environment = {\n  production: false,\n  openaiProxyUrl: '/api/openai/suggestion'\n};\n","import { bootstrapApplication } from '@angular/platform-browser';\r\nimport { appConfig } from './app/app.config';\r\nimport { AppComponent } from './app/app.component';\r\n\r\nbootstrapApplication(AppComponent, appConfig)\r\n  .catch((err) => console.error(err));\r\n"],"names":["CommonModule","combineLatest","map","CardGridComponent","ToolbarComponent","StatsPanelComponent","HandSelectorComponent","AISuggestionPanelComponent","LogBarComponent","CardState","GamePhase","i0","elementStart","text","elementEnd","listener","AppComponent_div_7_Template_app_card_grid_cardClicked_4_listener","$event","restoredCtx","restoreView","_r4","tableVm_r2","ngIf","ctx_r3","nextContext","resetView","onTableCardClicked","phase","element","advance","property","cardStates","probabilities","selectableCardIds","AppComponent","constructor","gameStateService","probabilityService","aiSuggestionService","gamePhase","phase$","tableVm$","state","probabilities$","pipe","probabilityRecord","rank","get","buildSelectableSet","cardId","CHOOSE_COMBINATION","selectCombinationCard","clickTableCard","selectable","Set","INITIAL_FOUR","cardState","Object","entries","UNKNOWN","ON_TABLE","add","PLAYING","turn","IN_MY_HAND","COMBINATION_CANDIDATE","directiveInject","i1","GameStateService","i2","ProbabilityService","i3","AISuggestionService","selectors","standalone","features","StandaloneFeature","decls","vars","consts","template","AppComponent_Template","rf","ctx","template","AppComponent_div_5_Template","AppComponent_div_7_Template","pipeBind1","i4","NgIf","AsyncPipe","styles","provideHttpClient","provideRouter","routes","appConfig","providers","aiSuggestion$","aiSuggestion","aiLoading$","aiLoading","apiConfigured","isApiConfigured","manualQuery","AISuggestionPanelComponent_Template","AISuggestionPanelComponent_div_3_Template","AISuggestionPanelComponent_p_5_Template","AISuggestionPanelComponent_Template_button_click_9_listener","textInterpolate","EventEmitter","classProp","ctx_r0","textInterpolate1","subText","CardCellComponent","probability","mode","clicked","onClick","PLAYED","emit","mainText","card","Math","round","showSubText","inputs","outputs","CardCellComponent_Template","CardCellComponent_Template_button_click_0_listener","CardCellComponent_span_3_Template","ON_TABLE_BLINKING","RANKS","SUITS","createCardId","suit_r2","elementContainerStart","CardGridComponent_tr_5_td_1_ng_container_1_Template_app_card_cell_clicked_1_listener","_r9","card_r7","ctx_r8","onCardClick","id","elementContainerEnd","ctx_r6","getState","getProbability","rank_r3","isSelectable","CardGridComponent_tr_5_td_1_ng_container_1_Template","ctx_r4","getCard","suit_r5","CardGridComponent_tr_5_td_1_Template","ctx_r1","suits","trackBySuit","cardClicked","ranks","trackByRank","_","suit","has","CardGridComponent_Template","CardGridComponent_th_3_Template","CardGridComponent_tr_5_Template","NgForOf","HandSelectorComponent_div_0_Template_app_card_grid_cardClicked_3_listener","_r3","ctx_r2","onCardClicked","vm_r1","myHandCount","emptyProbabilities","tmp_4_0","undefined","initialPhase","vm$","myHand","length","clickHandCard","HandSelectorComponent_Template","HandSelectorComponent_div_0_Template","logText$","lastPlayLog","value","LogBarComponent_Template","CARD_BY_ID","Suit","stats_r1","denariPlayed","totalPlayed","remaining","phaseLabel","stats$","playedIds","filter","Denari","toPhaseLabel","StatsPanelComponent_Template","StatsPanelComponent_div_0_Template","ToolbarComponent_div_0_Template_button_click_1_listener","cycleOpponentCards","opponent","ToolbarComponent_div_0_Template_button_click_3_listener","reset","ToolbarComponent_div_0_Template_button_click_5_listener","ctx_r5","undo","ToolbarComponent_div_0_Template_button_click_7_listener","setTurn","ToolbarComponent_div_0_Template_button_click_9_listener","ctx_r7","canUndo","opponentCardCount$","opponentCardCount","turn$","canUndo$","history","current","next","setOpponentCardCount","confirmed","window","confirm","ToolbarComponent_Template","ToolbarComponent_div_0_Template","pureFunction3","_c0","Coppe","Spade","Bastoni","toLowerCase","ALL_CARDS","flatMap","reduce","acc","Subject","debounceTime","distinctUntilChanged","finalize","of","switchMap","takeUntil","tap","catchError","environment","openAiService","destroy$","latestState","latestProbabilities","Map","key","buildTriggerKey","a","b","executeQuery","subscribe","ngOnDestroy","complete","endpoint","openaiProxyUrl","trim","setAiLoading","setAiSuggestion","input","buildQueryInput","queryBestMove","suggestion","probabilitiesByRank","playedStates","playedCards","cardLabel","unknownCardsCount","values","cardsOnTable","probabilityVector","Array","from","index","JSON","stringify","pendingPlayedCard","selectedCombination","rankLabel","toString","inject","OpenAIService","factory","fac","providedIn","findCombinations","CardTrackerService","handleTableCardClick","snapshot","errorResult","didMutate","handleInitialFour","okResult","handlePlay","handleCombinationSelection","includes","pending","selectedCards","selectedSum","tableCards","tableCard","validCombinations","isValidSelection","matchesAnyCombination","selectedId","actor","actorLabel","selectedLabel","join","error","shouldToggleTurn","shouldDecrementOpponent","initialFourCount","max","playedCard","isMyPlay","combinations","combo","comboIds","comboId","capturedLabel","selectedIds","selectedKey","sort","some","combination","comboKey","message","BehaviorSubject","cardTracker","localStorageService","storageKey","stateSubject","createInitialState","asObservable","restoreState","getCurrentState","commit","previous","restored","cloneSnapshot","slice","applyMutation","draft","setTurnWithOpponentRefill","toggleTurn","nextTurn","result","nextValue","clamp","decrementOpponentCards","loading","mutator","cloneState","push","toSnapshot","save","loaded","load","normalizeState","raw","normalizeSnapshot","historyRaw","isArray","item","initial","createInitialSnapshot","validStates","phaseValues","uniqueIds","ids","min","LocalStorageService","prefix","data","localStorage","setItem","buildKey","getItem","parse","remove","removeItem","http","post","response","HttpClient","shareReplay","computeProbabilities","bufferSize","refCount","unknownByRank","set","totalUnknown","drawSize","unknownOfRank","denominator","numerator","n","k","kk","i","targetSum","maxMask","mask","sum","subset","production","bootstrapApplication","catch","err","console"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}